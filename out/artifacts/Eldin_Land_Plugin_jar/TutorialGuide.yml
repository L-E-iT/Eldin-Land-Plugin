cchat:
    type: format
    format: "<&2><npc.name><&f><&co> <&6><text>"

TutorialGuide:
    type: assignment
    actions:
        on assignment:
        - trigger name:chat state:true
        - trigger name:click state:true
    Interact Scripts:
    - 10 guide_interact
    
guide_interact:
    type: Interact
    Steps:
        '1':
            click trigger:
                Script:
                - narrate format:cchat "Hello! Would you like a short tour?"
                - if <player.has_flag[TutorialComplete]> = false {
                  - narrate format:cchat "As this is your first time completing the tutorial, you are eligible for a 300tb reward!"
                  }
                - narrate "Say /yes/ or /no/"
            chat trigger:
                1:
                    trigger: /Yes/, I'd love one!
                    script:
                    - narrate format:cchat "Great! I love tours!"
                    - ^create player Guide <npc.location> save:guide
                    - ^adjust <player> hide_entity:<npc>
                    - ^adjust <server.list_online_players.exclude[<player>]> hide_entity:<entry[guide].created_npc>
                    - ^run guide_path npc:<entry[guide].created_npc> def:<^npc>
                    
                    - flag <player> completedtutorial
                    - zap 2
                    
                2:
                    trigger: /No/, I would not.
                    script:
                    - narrate format:cchat "Okay, enjoy your time at Eldin!"
        '2':
            Script:
            - wait 120
            - narrate format:cchat "I'm assuming you are AFK - I'll be back at the start if you need me!"
            - zap 1
            - queue clear
                    
guide_path:
    type: task
    definitions: masterguide
    script:
    - ~walk <def[masterguide].anchor[spot1]> auto_range
    - ~inject guide_talk_welcomeintrorules
    - ^inject guide_trypause
    - ~walk <def[masterguide].anchor[spot2]> auto_range
    - ~inject guide_talk_money
    - ^inject guide_trypause
    - ~walk <def[masterguide].anchor[spot3]> auto_range
    - ~inject guide_talk_land
    - ^inject guide_trypause
    - ~walk <def[masterguide].anchor[spot4]> auto_range
    - ~inject guide_talk_shops
    - ^inject guide_trypause
    - ~walk <def[masterguide].anchor[spot5]> auto_range
    - ~inject guide_talk_ranks
    - ^inject guide_trypause
    - ~walk <def[masterguide].anchor[spot6]> auto_range
    - ~inject guide_talk_graveyards
    - ^inject guide_trypause
    - ~walk <def[masterguide].anchor[spot7]> auto_range
    - ~inject guide_talk_city
    - ^inject guide_trypause
    - narrate format:cchat "Feel free to talk to the other NPC's around this island. When you're ready to continue, drop into the hole in the center structure!"
    - wait 3
    - if <player.has_flag[TutorialComplete]> = false {
      - narrate format:cchat "As this is your first time completing the tutorial, you get a 300tb reward!"
      - wait 1
      - ^narrate "<gold>[You have recieved 300tb!]"
      - ^execute as_op "eco give <player.name> 300"
      }
    - flag player TutorialComplete
    - ~walk <def[masterguide].location> auto_range
    - wait 1
    - remove <npc>
    - adjust <player> show_entity:<def[masterguide]>
    - zap 1 script:s@guide_interact
        
guide_trypause:
    type: task
    script:
    - if <p@player.is_online> = false {
      - remove <npc>
      - adjust <player> show_entity:<def[masterguide]>
      - zap 1 script:s@guide_interact
      - queue clear
      }
    - ^while <npc.location.distance[<player.location>].is[OR_MORE].than[5]> {
      - if <npc.location.distance[<player.location>].is[OR_MORE].than[30]> {
        - narrate format:cchat "I see you don't want to complete the tutorial. Enjoy your time at Eldin!"
        - remove <npc>
        - adjust <player> show_entity:<def[masterguide]>
        - zap 1 script:s@guide_interact
        - queue clear
        }
        else {
        - narrate format:cchat "Try to keep up!"
        - wait 5
        - flag player tutorialcheck:++
        }
        }
        
guide_talk_welcomeintrorules:
    type: task
    script:
    - lookclose true <entry[guide].created_npc>
    - ^narrate format:cchat "Hey <player.name>, thanks for taking the time to come on this tour. The purpose is to outline the basic aspects of Eldin, and introduce you to individuals who can tell you more."
    - wait 7
    - ^narrate format:cchat "Before we start, make sure not to use any cheats like x-ray, flying, auto-fishing, or any kind of hacked client, etc. Eldin is meant to be a challenging experience!"
    - wait 6
    - lookclose false <entry[guide].created_npc>
    
guide_talk_money:
    type: task
    script:
    - lookclose true <entry[guide].created_npc>
    - narrate format:cchat "So the main basis of Eldin is money; we are an economical server, and your main focus during your time here will be making money."
    - wait 6
    - narrate format:cchat "You can make money by selling items to shops; generally located in cities. Mining, farming and fishing are the most popular ways to make money - talk to the Banker to learn more after this tour."
    - wait 6
    - lookclose false <entry[guide].created_npc>
    
guide_talk_land:
    type: task
    script:
    - lookclose true <entry[guide].created_npc>
    - narrate format:cchat "The main thing you're going to want to do with your money is buy land. You can buy land in the wild, in cities, and eventually make your own city or even create a nation!"
    - wait 6
    - narrate format:cchat "Having your own land is the only way to fully protect your items and buildings. In the wild, people can by default grief your stuff and steal your items. Talk to the Landowner to learn more after."
    - wait 6
    - lookclose false <entry[guide].created_npc>
    
guide_talk_city:
    type: task
    script:
    - lookclose true <entry[guide].created_npc>
    - narrate format:cchat "So like I just told you, you can eventually turn land into a city. For this you need at least 3600 wild tiles and a Town Hall built."
    - wait 6
    - narrate format:cchat "You can have special buildings in your city, sell land, and of course, continue expanding. It would be too much to say right now, so you can learn more on <&3>www.worldofeldin.com <&6>or by talking to the Bursar after."
    - wait 7
    - lookclose false <entry[guide].created_npc>
    
guide_talk_ranks:
    type: task
    script:
    - lookclose true <entry[guide].created_npc>
    - narrate format:cchat "You've probably noticed a bunch of ranks in chat. We have a quite a few of them. Each land type has them; there are city owner ranks, wild land, city landowners and even mixed land ranks."
    - wait 7
    - narrate format:cchat "If you decide to buy land in a city, you will most likely become a <&2>[Villager]<&6> or, if you decide to buy wild land, you will become a <&2>[Gentry]<&6>. Our website has much more info on ranks. Talk to the Lawyer later to learn more."
    - wait 8
    - lookclose false <entry[guide].created_npc>
    
guide_talk_graveyards:
    type: task
    script:
    - lookclose true <entry[guide].created_npc>
    - narrate format:cchat "We have a unique death system - by this I mean you won't spawn back at your bed. Yes; that's right, there is no point in sleeping."
    - wait 6
    - narrate format:cchat "You'll spawn at the nearest graveyard. Every portal has one; additionally, cities can buy them - there are quite a few already with one. Talk to the Crypt Master to learn more later."
    - wait 7
    - lookclose false <entry[guide].created_npc>
    
guide_talk_shops:
    type: task
    script:
    - lookclose true <entry[guide].created_npc>
    - narrate format:cchat "Shops will play a big role in your day to day life in eldin. That's how you make the most money - by selling items to them. Look for server shops, as they have the best prices."
    - wait 7
    - narrate format:cchat "Try to sell the book you have on you to the shop here. You'll recieve some starting money - but do that in a bit. Talk to the Shopkeeper if you want to learn more."
    - wait 6
    - lookclose false <entry[guide].created_npc>